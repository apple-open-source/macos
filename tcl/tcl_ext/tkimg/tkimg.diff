Index: Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/Makefile.in,v
retrieving revision 1.5
diff -u -p -r1.5 Makefile.in
--- Makefile.in	7 Feb 2003 07:08:34 -0000	1.5
+++ Makefile.in	30 Jul 2004 05:37:13 -0000
@@ -120,11 +120,17 @@ collate: all
 			exec_prefix=$$here/Img/exec_prefix		\
 			prefix=$$here/Img/prefix			\
 			pkglibdir=$$here/Img/exec_prefix/lib/Img	\
+			libdir=$$here/Img/exec_prefix/lib		\
+			DESTDIR=					\
 			;						\
 		cd $$here ; \
 		cat Img/exec_prefix/lib/Img/pkgIndex.tcl >> pkgIndex.tcl ; \
 	done
 	mv pkgIndex.tcl Img/exec_prefix/lib/Img/pkgIndex.tcl
+	for p in Img/exec_prefix/lib/*.sh ; do \
+		sed -e 's#$(libdir)/[^/ ]*\([/ ]\)#$(LIB_RUNTIME_DIR)\1#' \
+			$$p > $$p.1 && mv -f $$p.1 $$p ; \
+	done	
 
 install: collate
 	mkdir -p    $(INSTALL_ROOT)$(LIB_RUNTIME_DIR)
@@ -135,10 +141,11 @@ install: collate
 	for p in Img/exec_prefix/lib/*.sh ; do \
 		$(INSTALL_PROGRAM) $$p $(INSTALL_ROOT)$(libdir)/`basename $$p` ; \
 	done
-	mkdir -p $(INSTALL_ROOT)$(includedir)
+	if [ -n "`ls Img/prefix/include`" ]; then \
+	mkdir -p $(INSTALL_ROOT)$(includedir); \
 	for p in Img/prefix/include/* ; do \
 		$(INSTALL_PROGRAM) $$p $(INSTALL_ROOT)$(includedir)/`basename $$p` ; \
-	done
+	done; fi
 
 
 bindist:
Index: base/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/base/Makefile.in,v
retrieving revision 1.5
diff -u -p -r1.5 Makefile.in
--- base/Makefile.in	10 Dec 2002 06:26:43 -0000	1.5
+++ base/Makefile.in	30 Jul 2004 05:37:13 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): $($(PACKAGE)_OBJ
 $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 	${MAKE_STUB_LIB}
-	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -435,8 +437,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: base/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/base/configure,v
retrieving revision 1.4
diff -u -p -r1.4 configure
--- base/configure	4 Apr 2003 21:36:38 -0000	1.4
+++ base/configure	30 Jul 2004 05:37:13 -0000
@@ -5360,13 +5360,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5370: checking for X" >&5
+echo "configure:5378: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5428,12 +5436,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5432 "configure"
+#line 5440 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5437: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5445: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5502,14 +5510,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5506 "configure"
+#line 5514 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5513: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5521: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5599,12 +5607,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5603 "configure"
+#line 5611 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5608: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5616: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5624,15 +5632,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5628: checking for X11 header files" >&5
+echo "configure:5636: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5631 "configure"
+#line 5639 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5636: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5644: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5668,7 +5676,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5672: checking for X11 libraries" >&5
+echo "configure:5680: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5688,7 +5696,7 @@ echo "configure:5672: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5692: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5700: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5696,7 +5704,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5700 "configure"
+#line 5708 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5707,7 +5715,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5711: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5719: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5736,6 +5744,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5784,6 +5794,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5825,6 +5836,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -5845,7 +5857,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:5849: checking for tclsh" >&5
+echo "configure:5861: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5877,7 +5889,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:5881: checking for wish" >&5
+echo "configure:5893: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6163,6 +6175,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 s%@tkimg_BUILD_LIB_SPEC@%$tkimg_BUILD_LIB_SPEC%g
Index: base/tclconfig/tcl.m4
===================================================================
RCS file: /cvsroot/tkimg/tkimg/base/tclconfig/tcl.m4,v
retrieving revision 1.2
diff -u -p -r1.2 tcl.m4
--- base/tclconfig/tcl.m4	4 Apr 2003 21:36:39 -0000	1.2
+++ base/tclconfig/tcl.m4	30 Jul 2004 05:37:13 -0000
@@ -1917,7 +1917,14 @@ closedir(d);
 
 AC_DEFUN(TEA_PATH_X, [
     if test "${TEA_PLATFORM}" = "unix" ; then
-	TEA_PATH_UNIX_X
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		AC_DEFINE(MAC_OSX_TK)
+		;;
+	    *)
+		TEA_PATH_UNIX_X
+		;;
+	esac
     fi
 ])
 
@@ -2591,6 +2598,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -2632,6 +2640,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     AC_SUBST(MAKE_SHARED_LIB)
     AC_SUBST(MAKE_STATIC_LIB)
     AC_SUBST(MAKE_STUB_LIB)
+    AC_SUBST(RANLIB_STUB)
 ])
 
 #------------------------------------------------------------------------
Index: bmp/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/bmp/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- bmp/Makefile.in	7 Feb 2003 07:08:35 -0000	1.4
+++ bmp/Makefile.in	30 Jul 2004 05:37:13 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: bmp/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/bmp/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- bmp/configure	4 Apr 2003 21:36:40 -0000	1.5
+++ bmp/configure	30 Jul 2004 05:37:13 -0000
@@ -5516,13 +5516,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5526: checking for X" >&5
+echo "configure:5534: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5584,12 +5592,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5588 "configure"
+#line 5596 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5593: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5601: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5658,14 +5666,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5662 "configure"
+#line 5670 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5669: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5677: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5755,12 +5763,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5759 "configure"
+#line 5767 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5764: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5772: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5780,15 +5788,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5784: checking for X11 header files" >&5
+echo "configure:5792: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5787 "configure"
+#line 5795 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5792: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5800: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5824,7 +5832,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5828: checking for X11 libraries" >&5
+echo "configure:5836: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5844,7 +5852,7 @@ echo "configure:5828: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5848: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5856: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5852,7 +5860,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5856 "configure"
+#line 5864 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5863,7 +5871,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5867: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5875: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5892,6 +5900,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5944,6 +5954,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5985,6 +5996,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6011,7 +6023,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6015: checking for tclsh" >&5
+echo "configure:6027: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6043,7 +6055,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6047: checking for wish" >&5
+echo "configure:6059: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6302,6 +6314,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: gif/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/gif/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- gif/Makefile.in	7 Feb 2003 07:08:35 -0000	1.4
+++ gif/Makefile.in	30 Jul 2004 05:37:13 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: gif/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/gif/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- gif/configure	4 Apr 2003 21:36:41 -0000	1.5
+++ gif/configure	30 Jul 2004 05:37:14 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: ico/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/ico/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- ico/Makefile.in	7 Feb 2003 07:08:35 -0000	1.4
+++ ico/Makefile.in	30 Jul 2004 05:37:14 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: ico/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/ico/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- ico/configure	4 Apr 2003 21:36:42 -0000	1.5
+++ ico/configure	30 Jul 2004 05:37:14 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: jpeg/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/jpeg/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- jpeg/Makefile.in	7 Feb 2003 07:08:35 -0000	1.4
+++ jpeg/Makefile.in	30 Jul 2004 05:37:14 -0000
@@ -144,6 +144,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -171,6 +172,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -310,7 +312,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -453,8 +455,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: jpeg/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/jpeg/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- jpeg/configure	4 Apr 2003 21:36:44 -0000	1.5
+++ jpeg/configure	30 Jul 2004 05:37:14 -0000
@@ -5664,13 +5664,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5674: checking for X" >&5
+echo "configure:5682: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5732,12 +5740,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5736 "configure"
+#line 5744 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5741: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5749: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5806,14 +5814,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5810 "configure"
+#line 5818 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5817: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5825: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5903,12 +5911,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5907 "configure"
+#line 5915 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5912: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5920: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5928,15 +5936,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5932: checking for X11 header files" >&5
+echo "configure:5940: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5935 "configure"
+#line 5943 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5940: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5948: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5972,7 +5980,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5976: checking for X11 libraries" >&5
+echo "configure:5984: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5992,7 +6000,7 @@ echo "configure:5976: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5996: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:6004: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6000,7 +6008,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6004 "configure"
+#line 6012 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6011,7 +6019,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:6015: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6023: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -6040,6 +6048,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -6096,6 +6106,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -6137,6 +6148,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6165,7 +6177,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6169: checking for tclsh" >&5
+echo "configure:6181: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6197,7 +6209,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6201: checking for wish" >&5
+echo "configure:6213: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6465,6 +6477,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: libjpeg/tcl/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libjpeg/tcl/Makefile.in,v
retrieving revision 1.2
diff -u -p -r1.2 Makefile.in
--- libjpeg/tcl/Makefile.in	7 Dec 2002 00:11:37 -0000	1.2
+++ libjpeg/tcl/Makefile.in	30 Jul 2004 05:37:14 -0000
@@ -159,6 +159,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -182,6 +183,7 @@ TCL_LIBS	= @TCL_LIBS@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -306,7 +308,7 @@ $($(PACKAGE)_LIB_FILE): $($(PACKAGE)_OBJ
 $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 	${MAKE_STUB_LIB}
-	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: libjpeg/tcl/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libjpeg/tcl/configure,v
retrieving revision 1.2
diff -u -p -r1.2 configure
--- libjpeg/tcl/configure	4 Apr 2003 21:36:52 -0000	1.2
+++ libjpeg/tcl/configure	30 Jul 2004 05:37:14 -0000
@@ -5182,6 +5182,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5223,6 +5224,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -5243,7 +5245,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TCL_L
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:5247: checking for tclsh" >&5
+echo "configure:5249: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5537,6 +5539,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@jpegtcl_BUILD_LIB_SPEC@%$jpegtcl_BUILD_LIB_SPEC%g
 s%@jpegtcl_LIB_SPEC@%$jpegtcl_LIB_SPEC%g
Index: libjpeg/tcl/tclconfig/tcl.m4
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libjpeg/tcl/tclconfig/tcl.m4,v
retrieving revision 1.2
diff -u -p -r1.2 tcl.m4
--- libjpeg/tcl/tclconfig/tcl.m4	4 Apr 2003 21:36:52 -0000	1.2
+++ libjpeg/tcl/tclconfig/tcl.m4	30 Jul 2004 05:37:15 -0000
@@ -1917,7 +1917,14 @@ closedir(d);
 
 AC_DEFUN(TEA_PATH_X, [
     if test "${TEA_PLATFORM}" = "unix" ; then
-	TEA_PATH_UNIX_X
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		AC_DEFINE(MAC_OSX_TK)
+		;;
+	    *)
+		TEA_PATH_UNIX_X
+		;;
+	esac
     fi
 ])
 
@@ -2591,6 +2598,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -2632,6 +2640,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     AC_SUBST(MAKE_SHARED_LIB)
     AC_SUBST(MAKE_STATIC_LIB)
     AC_SUBST(MAKE_STUB_LIB)
+    AC_SUBST(RANLIB_STUB)
 ])
 
 #------------------------------------------------------------------------
Index: libpng/tcl/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libpng/tcl/Makefile.in,v
retrieving revision 1.3
diff -u -p -r1.3 Makefile.in
--- libpng/tcl/Makefile.in	10 Dec 2002 06:26:44 -0000	1.3
+++ libpng/tcl/Makefile.in	30 Jul 2004 05:37:15 -0000
@@ -152,6 +152,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -175,6 +176,7 @@ TCL_LIBS	= @TCL_LIBS@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -295,13 +297,13 @@
 
 $($(PACKAGE)_LIB_FILE): $($(PACKAGE)_OBJECTS)
 	-rm -f $($(PACKAGE)_LIB_FILE)
-	${MAKE_LIB}
+	${MAKE_LIB} -lz
 	$(RANLIB) $($(PACKAGE)_LIB_FILE)
 
 $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 	${MAKE_STUB_LIB}
-	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -437,8 +439,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: libpng/tcl/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libpng/tcl/configure,v
retrieving revision 1.2
diff -u -p -r1.2 configure
--- libpng/tcl/configure	4 Apr 2003 21:36:53 -0000	1.2
+++ libpng/tcl/configure	30 Jul 2004 05:37:15 -0000
@@ -5329,6 +5329,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5370,6 +5371,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -5396,7 +5398,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TCL_L
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:5400: checking for tclsh" >&5
+echo "configure:5402: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5677,6 +5679,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@pngtcl_BUILD_LIB_SPEC@%$pngtcl_BUILD_LIB_SPEC%g
 s%@pngtcl_LIB_SPEC@%$pngtcl_LIB_SPEC%g
Index: libpng/tcl/tclconfig/tcl.m4
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libpng/tcl/tclconfig/tcl.m4,v
retrieving revision 1.2
diff -u -p -r1.2 tcl.m4
--- libpng/tcl/tclconfig/tcl.m4	4 Apr 2003 21:36:54 -0000	1.2
+++ libpng/tcl/tclconfig/tcl.m4	30 Jul 2004 05:37:15 -0000
@@ -1917,7 +1917,14 @@ closedir(d);
 
 AC_DEFUN(TEA_PATH_X, [
     if test "${TEA_PLATFORM}" = "unix" ; then
-	TEA_PATH_UNIX_X
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		AC_DEFINE(MAC_OSX_TK)
+		;;
+	    *)
+		TEA_PATH_UNIX_X
+		;;
+	esac
     fi
 ])
 
@@ -2591,6 +2598,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -2632,6 +2640,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     AC_SUBST(MAKE_SHARED_LIB)
     AC_SUBST(MAKE_STATIC_LIB)
     AC_SUBST(MAKE_STUB_LIB)
+    AC_SUBST(RANLIB_STUB)
 ])
 
 #------------------------------------------------------------------------
Index: libtiff/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libtiff/Makefile.in,v
retrieving revision 1.1.1.1
diff -u -p -r1.1.1.1 Makefile.in
--- libtiff/Makefile.in	10 May 2002 17:20:32 -0000	1.1.1.1
+++ libtiff/Makefile.in	30 Jul 2004 05:37:15 -0000
@@ -39,6 +39,7 @@ CC	= @CCOMPILER@
 AR	= @AR@
 AROPTS	= @AROPTS@
 RANLIB	= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 INSTALL	= @INSTALL@
 
 #
Index: libtiff/tcl/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libtiff/tcl/Makefile.in,v
retrieving revision 1.2
diff -u -p -r1.2 Makefile.in
--- libtiff/tcl/Makefile.in	7 Dec 2002 00:11:37 -0000	1.2
+++ libtiff/tcl/Makefile.in	30 Jul 2004 05:37:15 -0000
@@ -153,6 +153,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -176,6 +177,7 @@ TCL_LIBS	= @TCL_LIBS@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -300,7 +302,7 @@ $($(PACKAGE)_LIB_FILE): $($(PACKAGE)_OBJ
 $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 	${MAKE_STUB_LIB}
-	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -436,8 +438,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: libtiff/tcl/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libtiff/tcl/configure,v
retrieving revision 1.2
diff -u -p -r1.2 configure
--- libtiff/tcl/configure	4 Apr 2003 21:36:55 -0000	1.2
+++ libtiff/tcl/configure	30 Jul 2004 05:37:15 -0000
@@ -5290,6 +5290,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5331,6 +5332,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -5351,7 +5353,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TCL_L
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:5355: checking for tclsh" >&5
+echo "configure:5357: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5651,6 +5653,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@tifftcl_BUILD_LIB_SPEC@%$tifftcl_BUILD_LIB_SPEC%g
 s%@tifftcl_LIB_SPEC@%$tifftcl_LIB_SPEC%g
Index: libtiff/tcl/tclconfig/tcl.m4
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libtiff/tcl/tclconfig/tcl.m4,v
retrieving revision 1.2
diff -u -p -r1.2 tcl.m4
--- libtiff/tcl/tclconfig/tcl.m4	4 Apr 2003 21:36:55 -0000	1.2
+++ libtiff/tcl/tclconfig/tcl.m4	30 Jul 2004 05:37:15 -0000
@@ -1917,7 +1917,14 @@ closedir(d);
 
 AC_DEFUN(TEA_PATH_X, [
     if test "${TEA_PLATFORM}" = "unix" ; then
-	TEA_PATH_UNIX_X
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		AC_DEFINE(MAC_OSX_TK)
+		;;
+	    *)
+		TEA_PATH_UNIX_X
+		;;
+	esac
     fi
 ])
 
@@ -2591,6 +2598,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -2632,6 +2640,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     AC_SUBST(MAKE_SHARED_LIB)
     AC_SUBST(MAKE_STATIC_LIB)
     AC_SUBST(MAKE_STUB_LIB)
+    AC_SUBST(RANLIB_STUB)
 ])
 
 #------------------------------------------------------------------------
Index: libz/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libz/Makefile.in,v
retrieving revision 1.1.1.1
diff -u -p -r1.1.1.1 Makefile.in
--- libz/Makefile.in	10 May 2002 17:20:13 -0000	1.1.1.1
+++ libz/Makefile.in	30 Jul 2004 05:37:15 -0000
@@ -61,6 +61,7 @@ all: example minigzip
 
 test: all
 	@LD_LIBRARY_PATH=.:$(LD_LIBRARY_PATH) ; export LD_LIBRARY_PATH; \
+	@DYLD_LIBRARY_PATH=.:$(DYLD_LIBRARY_PATH) ; export DYLD_LIBRARY_PATH; \
 	echo hello world | ./minigzip | ./minigzip -d || \
 	  echo '		*** minigzip test FAILED ***' ; \
 	if ./example; then \
Index: libz/tcl/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libz/tcl/Makefile.in,v
retrieving revision 1.2
diff -u -p -r1.2 Makefile.in
--- libz/tcl/Makefile.in	7 Dec 2002 00:11:37 -0000	1.2
+++ libz/tcl/Makefile.in	30 Jul 2004 05:37:15 -0000
@@ -31,19 +31,11 @@
 		zlibtcl.c		\
 		zlibtclStubInit.c	\
 		zlibtclStubLib.c	\
-		$(zlib_Sources)		\
 		@EXTRA_SOURCES@
 
 WIN_SOURCES	= 
 UNIX_SOURCES	= 
 
-zlib_Sources	=						\
-		adler32.c	compress.c	crc32.c		\
-		deflate.c	gzio.c		infblock.c	\
-		infcodes.c	inffast.c	inflate.c	\
-		inftrees.c	infutil.c	trees.c		\
-		uncompr.c	zutil.c
-
 #========================================================================
 # Identify the object files.  This replaces .c with .$(OBJEXT) for all
 # the named source files.   These objects are created and linked into the
@@ -148,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -171,6 +164,7 @@ TCL_LIBS	= @TCL_LIBS@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -289,13 +283,13 @@
 
 $($(PACKAGE)_LIB_FILE): $($(PACKAGE)_OBJECTS)
 	-rm -f $($(PACKAGE)_LIB_FILE)
-	${MAKE_LIB}
+	${MAKE_LIB} -lz
 	$(RANLIB) $($(PACKAGE)_LIB_FILE)
 
 $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 	${MAKE_STUB_LIB}
-	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -431,8 +425,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: libz/tcl/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libz/tcl/configure,v
retrieving revision 1.2
diff -u -p -r1.2 configure
--- libz/tcl/configure	4 Apr 2003 21:36:56 -0000	1.2
+++ libz/tcl/configure	30 Jul 2004 05:37:16 -0000
@@ -5180,6 +5180,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5241,7 +5242,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TCL_L
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:5245: checking for tclsh" >&5
+echo "configure:5247: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5514,6 +5516,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@zlibtcl_BUILD_LIB_SPEC@%$zlibtcl_BUILD_LIB_SPEC%g
 s%@zlibtcl_LIB_SPEC@%$zlibtcl_LIB_SPEC%g
Index: libz/tcl/tclconfig/tcl.m4
===================================================================
RCS file: /cvsroot/tkimg/tkimg/libz/tcl/tclconfig/tcl.m4,v
retrieving revision 1.2
diff -u -p -r1.2 tcl.m4
--- libz/tcl/tclconfig/tcl.m4	4 Apr 2003 21:36:57 -0000	1.2
+++ libz/tcl/tclconfig/tcl.m4	30 Jul 2004 05:37:16 -0000
@@ -1917,7 +1917,14 @@ closedir(d);
 
 AC_DEFUN(TEA_PATH_X, [
     if test "${TEA_PLATFORM}" = "unix" ; then
-	TEA_PATH_UNIX_X
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		AC_DEFINE(MAC_OSX_TK)
+		;;
+	    *)
+		TEA_PATH_UNIX_X
+		;;
+	esac
     fi
 ])
 
@@ -2591,6 +2598,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -2632,6 +2640,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     AC_SUBST(MAKE_SHARED_LIB)
     AC_SUBST(MAKE_STATIC_LIB)
     AC_SUBST(MAKE_STUB_LIB)
+    AC_SUBST(RANLIB_STUB)
 ])
 
 #------------------------------------------------------------------------
--- libz/tcl/zlibtclDecls.h~	Tue May  9 18:09:56 2006
+++ libz/tcl/zlibtclDecls.h	Tue May  9 18:09:56 2006
@@ -17,7 +17,7 @@
 
 #include <tcl.h>
 #include <zlibtclDeclsMask.h>
-#include <../zlib.h>
+#include <zlib.h>
 #include <zlibtclDeclsUnmask.h>
 
 /* !BEGIN!: Do not edit below this line. */
@@ -109,7 +109,7 @@
 EXTERN int		gzread _ANSI_ARGS_((gzFile file, voidp buf, 
 				unsigned len));
 /* 34 */
-EXTERN int		gzwrite _ANSI_ARGS_((gzFile file, const voidp buf, 
+EXTERN int		gzwrite _ANSI_ARGS_((gzFile file, voidpc buf, 
 				unsigned len));
 /* Slot 35 is reserved */
 /* 36 */
Index: pcx/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/pcx/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- pcx/Makefile.in	7 Feb 2003 07:08:35 -0000	1.4
+++ pcx/Makefile.in	30 Jul 2004 05:37:16 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: pcx/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/pcx/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- pcx/configure	4 Apr 2003 21:36:58 -0000	1.5
+++ pcx/configure	30 Jul 2004 05:37:16 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: pixmap/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/pixmap/Makefile.in,v
retrieving revision 1.3
diff -u -p -r1.3 Makefile.in
--- pixmap/Makefile.in	7 Feb 2003 07:08:35 -0000	1.3
+++ pixmap/Makefile.in	30 Jul 2004 05:37:16 -0000
@@ -141,6 +141,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -170,6 +171,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -305,7 +307,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -446,8 +448,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: pixmap/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/pixmap/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- pixmap/configure	4 Apr 2003 21:36:59 -0000	1.5
+++ pixmap/configure	30 Jul 2004 05:37:16 -0000
@@ -5590,13 +5590,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5600: checking for X" >&5
+echo "configure:5608: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5658,12 +5666,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5662 "configure"
+#line 5670 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5667: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5675: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5732,14 +5740,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5736 "configure"
+#line 5744 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5743: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5751: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5829,12 +5837,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5833 "configure"
+#line 5841 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5838: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5846: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5854,15 +5862,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5858: checking for X11 header files" >&5
+echo "configure:5866: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5861 "configure"
+#line 5869 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5866: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5874: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5898,7 +5906,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5902: checking for X11 libraries" >&5
+echo "configure:5910: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5918,7 +5926,7 @@ echo "configure:5902: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5922: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5930: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5926,7 +5934,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5930 "configure"
+#line 5938 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5937,7 +5945,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5941: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5949: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5966,6 +5974,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -6018,6 +6028,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -6059,6 +6070,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6085,7 +6097,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6089: checking for tclsh" >&5
+echo "configure:6101: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6117,7 +6129,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6121: checking for wish" >&5
+echo "configure:6133: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6389,6 +6401,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: png/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/png/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- png/Makefile.in	7 Feb 2003 07:08:36 -0000	1.4
+++ png/Makefile.in	30 Jul 2004 05:37:16 -0000
@@ -148,6 +148,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -175,6 +176,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -317,7 +319,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -460,8 +462,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: png/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/png/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- png/configure	4 Apr 2003 21:37:00 -0000	1.5
+++ png/configure	30 Jul 2004 05:37:17 -0000
@@ -5812,13 +5812,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5822: checking for X" >&5
+echo "configure:5830: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5880,12 +5888,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5884 "configure"
+#line 5892 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5889: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5897: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5954,14 +5962,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5958 "configure"
+#line 5966 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5965: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5973: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -6051,12 +6059,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 6055 "configure"
+#line 6063 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:6060: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:6068: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -6076,15 +6084,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:6080: checking for X11 header files" >&5
+echo "configure:6088: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 6083 "configure"
+#line 6091 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:6088: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:6096: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -6120,7 +6128,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:6124: checking for X11 libraries" >&5
+echo "configure:6132: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -6140,7 +6148,7 @@ echo "configure:6124: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:6144: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:6152: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6148,7 +6156,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6152 "configure"
+#line 6160 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6159,7 +6167,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:6163: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6171: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -6188,6 +6196,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -6248,6 +6258,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -6289,6 +6300,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6317,7 +6329,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6321: checking for tclsh" >&5
+echo "configure:6333: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6349,7 +6361,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6353: checking for wish" >&5
+echo "configure:6365: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6626,6 +6638,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: ppm/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/ppm/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- ppm/Makefile.in	7 Feb 2003 07:08:36 -0000	1.4
+++ ppm/Makefile.in	30 Jul 2004 05:37:17 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: ppm/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/ppm/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- ppm/configure	4 Apr 2003 21:37:01 -0000	1.5
+++ ppm/configure	30 Jul 2004 05:37:17 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: ps/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/ps/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- ps/Makefile.in	7 Feb 2003 07:08:36 -0000	1.4
+++ ps/Makefile.in	30 Jul 2004 05:37:17 -0000
@@ -141,6 +141,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -168,6 +169,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -301,7 +303,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -445,8 +447,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: ps/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/ps/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- ps/configure	4 Apr 2003 21:37:02 -0000	1.5
+++ ps/configure	30 Jul 2004 05:37:17 -0000
@@ -5517,13 +5517,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5527: checking for X" >&5
+echo "configure:5535: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5585,12 +5593,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5589 "configure"
+#line 5597 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5594: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5602: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5659,14 +5667,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5663 "configure"
+#line 5671 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5670: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5678: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5756,12 +5764,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5760 "configure"
+#line 5768 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5765: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5773: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5781,15 +5789,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5785: checking for X11 header files" >&5
+echo "configure:5793: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5788 "configure"
+#line 5796 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5793: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5801: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5825,7 +5833,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5829: checking for X11 libraries" >&5
+echo "configure:5837: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5845,7 +5853,7 @@ echo "configure:5829: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5849: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5857: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5853,7 +5861,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5857 "configure"
+#line 5865 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5864,7 +5872,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5868: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5876: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5893,6 +5901,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5945,6 +5955,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5986,6 +5997,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6012,7 +6024,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6016: checking for tclsh" >&5
+echo "configure:6028: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6044,7 +6056,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6048: checking for wish" >&5
+echo "configure:6060: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6304,6 +6316,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: sgi/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/sgi/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- sgi/Makefile.in	7 Feb 2003 07:08:36 -0000	1.4
+++ sgi/Makefile.in	30 Jul 2004 05:37:17 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: sgi/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/sgi/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- sgi/configure	4 Apr 2003 21:37:03 -0000	1.5
+++ sgi/configure	30 Jul 2004 05:37:17 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: sun/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/sun/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- sun/Makefile.in	7 Feb 2003 07:08:37 -0000	1.4
+++ sun/Makefile.in	30 Jul 2004 05:37:17 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: sun/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/sun/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- sun/configure	4 Apr 2003 21:37:04 -0000	1.5
+++ sun/configure	30 Jul 2004 05:37:18 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: tclconfig/tcl.m4
===================================================================
RCS file: /cvsroot/tkimg/tkimg/tclconfig/tcl.m4,v
retrieving revision 1.2
diff -u -p -r1.2 tcl.m4
--- tclconfig/tcl.m4	4 Apr 2003 21:37:04 -0000	1.2
+++ tclconfig/tcl.m4	30 Jul 2004 05:37:18 -0000
@@ -1917,7 +1917,14 @@ closedir(d);
 
 AC_DEFUN(TEA_PATH_X, [
     if test "${TEA_PLATFORM}" = "unix" ; then
-	TEA_PATH_UNIX_X
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		AC_DEFINE(MAC_OSX_TK)
+		;;
+	    *)
+		TEA_PATH_UNIX_X
+		;;
+	esac
     fi
 ])
 
@@ -2591,6 +2598,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -2632,6 +2640,7 @@ AC_DEFUN(TEA_MAKE_LIB, [
     AC_SUBST(MAKE_SHARED_LIB)
     AC_SUBST(MAKE_STATIC_LIB)
     AC_SUBST(MAKE_STUB_LIB)
+    AC_SUBST(RANLIB_STUB)
 ])
 
 #------------------------------------------------------------------------
Index: tga/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/tga/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- tga/Makefile.in	7 Feb 2003 07:08:37 -0000	1.4
+++ tga/Makefile.in	30 Jul 2004 05:37:18 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: tga/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/tga/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- tga/configure	4 Apr 2003 21:37:05 -0000	1.5
+++ tga/configure	30 Jul 2004 05:37:18 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: tiff/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/tiff/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- tiff/Makefile.in	7 Feb 2003 07:08:37 -0000	1.4
+++ tiff/Makefile.in	30 Jul 2004 05:37:18 -0000
@@ -155,6 +155,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -182,6 +183,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -327,7 +329,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -470,8 +472,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: tiff/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/tiff/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- tiff/configure	4 Apr 2003 21:37:06 -0000	1.5
+++ tiff/configure	30 Jul 2004 05:37:18 -0000
@@ -5960,13 +5960,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5970: checking for X" >&5
+echo "configure:5978: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -6028,12 +6036,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 6032 "configure"
+#line 6040 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:6037: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:6045: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -6102,14 +6110,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6106 "configure"
+#line 6114 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:6113: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6121: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -6199,12 +6207,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 6203 "configure"
+#line 6211 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:6208: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:6216: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -6224,15 +6232,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:6228: checking for X11 header files" >&5
+echo "configure:6236: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 6231 "configure"
+#line 6239 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:6236: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:6244: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -6268,7 +6276,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:6272: checking for X11 libraries" >&5
+echo "configure:6280: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -6288,7 +6296,7 @@ echo "configure:6272: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:6292: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:6300: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6296,7 +6304,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6300 "configure"
+#line 6308 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6307,7 +6315,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:6311: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6319: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -6336,6 +6344,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -6400,6 +6410,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -6441,6 +6452,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6473,7 +6485,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6477: checking for tclsh" >&5
+echo "configure:6489: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6505,7 +6517,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6509: checking for wish" >&5
+echo "configure:6521: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6791,6 +6803,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: tiff/tiffJpeg.c
===================================================================
RCS file: /cvsroot/tkimg/tkimg/tiff/tiffJpeg.c,v
retrieving revision 1.1
diff -u -p -r1.1 tiffJpeg.c
--- tiff/tiffJpeg.c	29 Nov 2002 08:57:56 -0000	1.1
+++ tiff/tiffJpeg.c	30 Jul 2004 05:37:18 -0000
@@ -225,7 +225,7 @@ TIFFjpeg_output_message(cinfo)
  * values per libtiff practice.
  */
 #define	CALLJPEG(sp, fail, op)	(SETJMP((sp)->exit_jmpbuf) ? (fail) : (op))
-#define	CALLVJPEG(sp, op)	CALLJPEG(sp, 0, ((op),1))
+#define	CALLVJPEG(sp, op)	    (SETJMP((sp)->exit_jmpbuf) ? (0) : ((op),1))
 
 
 static int
Index: window/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/window/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- window/Makefile.in	7 Feb 2003 07:08:37 -0000	1.4
+++ window/Makefile.in	30 Jul 2004 05:37:18 -0000
@@ -141,6 +141,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -170,6 +171,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -304,7 +306,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -447,8 +449,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: window/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/window/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- window/configure	4 Apr 2003 21:37:07 -0000	1.5
+++ window/configure	30 Jul 2004 05:37:19 -0000
@@ -5590,13 +5590,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5600: checking for X" >&5
+echo "configure:5608: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5658,12 +5666,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5662 "configure"
+#line 5670 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5667: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5675: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5732,14 +5740,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5736 "configure"
+#line 5744 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5743: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5751: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5829,12 +5837,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5833 "configure"
+#line 5841 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5838: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5846: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5854,15 +5862,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5858: checking for X11 header files" >&5
+echo "configure:5866: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5861 "configure"
+#line 5869 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5866: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5874: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5898,7 +5906,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5902: checking for X11 libraries" >&5
+echo "configure:5910: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5918,7 +5926,7 @@ echo "configure:5902: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5922: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5930: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5926,7 +5934,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5930 "configure"
+#line 5938 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5937,7 +5945,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5941: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5949: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5966,6 +5974,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -6018,6 +6028,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -6059,6 +6070,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6085,7 +6097,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6089: checking for tclsh" >&5
+echo "configure:6101: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6117,7 +6129,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6121: checking for wish" >&5
+echo "configure:6133: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6389,6 +6401,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: window/window.c
===================================================================
RCS file: /cvsroot/tkimg/tkimg/window/window.c,v
retrieving revision 1.1
diff -u -p -r1.1 window.c
--- window/window.c	29 Nov 2002 08:57:56 -0000	1.1
+++ window/window.c	30 Jul 2004 05:37:19 -0000
@@ -17,7 +17,13 @@
 
 #include "X11/Xutil.h"
 #ifndef	__WIN32__
+#  ifndef MAC_OSX_TK
 #   include "X11/Xproto.h"
+#  else
+#   include "X11/Xlib.h"
+#   include "X11/Xfuncproto.h"
+#   undef X_GetImage
+#  endif
 #else
 #   include <windows.h>
 #   include "X11/Xlib.h"
Index: xbm/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/xbm/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- xbm/Makefile.in	7 Feb 2003 07:08:37 -0000	1.4
+++ xbm/Makefile.in	30 Jul 2004 05:37:19 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: xbm/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/xbm/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- xbm/configure	4 Apr 2003 21:37:08 -0000	1.5
+++ xbm/configure	30 Jul 2004 05:37:19 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
Index: xpm/Makefile.in
===================================================================
RCS file: /cvsroot/tkimg/tkimg/xpm/Makefile.in,v
retrieving revision 1.4
diff -u -p -r1.4 Makefile.in
--- xpm/Makefile.in	7 Feb 2003 07:08:37 -0000	1.4
+++ xpm/Makefile.in	30 Jul 2004 05:37:19 -0000
@@ -140,6 +140,7 @@ MAKE_STATIC_LIB	= @MAKE_STATIC_LIB@
 MAKE_STUB_LIB	= @MAKE_STUB_LIB@
 OBJEXT		= @OBJEXT@
 RANLIB		= @RANLIB@
+RANLIB_STUB	= @RANLIB_STUB@
 SHLIB_CFLAGS	= @SHLIB_CFLAGS@
 SHLIB_LD	= @SHLIB_LD@
 SHLIB_LDFLAGS	= @SHLIB_LDFLAGS@
@@ -167,6 +168,7 @@ EXTRA_PATH	= $(top_builddir):$(TCL_BIN_D
 TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
 		  TK_LIBRARY=`@CYGPATH@ $(TK_SRC_DIR)/library` \
 		  LD_LIBRARY_PATH="$(EXTRA_PATH):$(LD_LIBRARY_PATH)" \
+		  DYLD_LIBRARY_PATH="$(EXTRA_PATH):$(DYLD_LIBRARY_PATH)" \
 		  LIBPATH="$(EXTRA_PATH):${LIBPATH}" \
 		  SHLIB_PATH="$(EXTRA_PATH):${SHLIB_PATH}" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -299,7 +301,7 @@ $($(PACKAGE)_LIB_FILE): init.c $($(PACKA
 # $($(PACKAGE)stub_LIB_FILE): $($(PACKAGE)stub_OBJECTS)
 # 	-rm -f $($(PACKAGE)stub_LIB_FILE)
 # 	${MAKE_STUB_LIB}
-# 	$(RANLIB) $($(PACKAGE)stub_LIB_FILE)
+# 	$(RANLIB_STUB) $($(PACKAGE)stub_LIB_FILE)
 
 #========================================================================
 # We need to enumerate the list of .c to .o lines here.
@@ -442,8 +444,14 @@ install-lib-binaries:
 	  if test -f $$p; then \
 	    echo " $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(INSTALL_PROGRAM) $$p $(DESTDIR)$(pkglibdir)/$$p; \
+	    stub=`echo $$p|sed -e "s/.*\(stub\).*/\1/"`; \
+	    if test "x$$stub" = "xstub"; then \
+	    echo " $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p"; \
+	    $(RANLIB_STUB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    else \
 	    echo " $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p"; \
 	    $(RANLIB) $(DESTDIR)$(pkglibdir)/$$p; \
+	    fi; \
 	    ext=`echo $$p|sed -e "s/.*\.//"`; \
 	    if test "x$$ext" = "xdll"; then \
 		lib=`basename $$p|sed -e 's/.[^.]*$$//'`.lib; \
Index: xpm/configure
===================================================================
RCS file: /cvsroot/tkimg/tkimg/xpm/configure,v
retrieving revision 1.5
diff -u -p -r1.5 configure
--- xpm/configure	4 Apr 2003 21:37:09 -0000	1.5
+++ xpm/configure	30 Jul 2004 05:37:19 -0000
@@ -5515,13 +5515,21 @@ EOF
 
 
     if test "${TEA_PLATFORM}" = "unix" ; then
-	
+	case ${TK_DEFS} in
+	    *_OSX_TK*)
+		cat >> confdefs.h <<\EOF
+#define MAC_OSX_TK 1
+EOF
+
+		;;
+	    *)
+		
     # If we find X, set shell vars x_includes and x_libraries to the
 # paths, otherwise set no_x=yes.
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:5525: checking for X" >&5
+echo "configure:5533: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -5583,12 +5591,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 5587 "configure"
+#line 5595 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5592: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5600: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -5657,14 +5665,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5661 "configure"
+#line 5669 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:5668: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -5754,12 +5762,12 @@ fi
     if test "$no_x" = ""; then
 	if test "$x_includes" = ""; then
 	    cat > conftest.$ac_ext <<EOF
-#line 5758 "configure"
+#line 5766 "configure"
 #include "confdefs.h"
 #include <X11/XIntrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5763: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5771: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5779,15 +5787,15 @@ rm -f conftest*
     fi
     if test "$no_x" = "yes" -o "$not_really_there" = "yes"; then
 	echo $ac_n "checking for X11 header files""... $ac_c" 1>&6
-echo "configure:5783: checking for X11 header files" >&5
+echo "configure:5791: checking for X11 header files" >&5
 	XINCLUDES="# no special path needed"
 	cat > conftest.$ac_ext <<EOF
-#line 5786 "configure"
+#line 5794 "configure"
 #include "confdefs.h"
 #include <X11/Intrinsic.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:5791: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:5799: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   :
@@ -5823,7 +5831,7 @@ rm -f conftest*
 
     if test "$no_x" = yes; then
 	echo $ac_n "checking for X11 libraries""... $ac_c" 1>&6
-echo "configure:5827: checking for X11 libraries" >&5
+echo "configure:5835: checking for X11 libraries" >&5
 	XLIBSW=nope
 	dirs="/usr/unsupported/lib /usr/local/lib /usr/X386/lib /usr/X11R6/lib /usr/X11R5/lib /usr/lib/X11R5 /usr/lib/X11R4 /usr/openwin/lib /usr/X11/lib /usr/sww/X11/lib"
 	for i in $dirs ; do
@@ -5843,7 +5851,7 @@ echo "configure:5827: checking for X11 l
     fi
     if test "$XLIBSW" = nope ; then
 	echo $ac_n "checking for XCreateWindow in -lXwindow""... $ac_c" 1>&6
-echo "configure:5847: checking for XCreateWindow in -lXwindow" >&5
+echo "configure:5855: checking for XCreateWindow in -lXwindow" >&5
 ac_lib_var=`echo Xwindow'_'XCreateWindow | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -5851,7 +5859,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXwindow  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 5855 "configure"
+#line 5863 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -5862,7 +5870,7 @@ int main() {
 XCreateWindow()
 ; return 0; }
 EOF
-if { (eval echo configure:5866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -5891,6 +5899,8 @@ fi
 	LIBS="${LIBS} ${XLIBSW}"
     fi
 
+		;;
+	esac
     fi
 
 
@@ -5943,6 +5953,7 @@ EOF
     # substituted.
     #--------------------------------------------------------------------
 
+    RANLIB_STUB="${RANLIB}"
     if test "${TEA_PLATFORM}" = "windows" ; then
 	if test "${SHARED_BUILD}" = "1" ; then
 	    # We force the unresolved linking of symbols that are really in
@@ -5984,6 +5995,7 @@ EOF
     
     
     
+    
 
 
 #--------------------------------------------------------------------
@@ -6010,7 +6022,7 @@ SHLIB_LD_LIBS="${SHLIB_LD_LIBS} \${TK_LI
 
 
     echo $ac_n "checking for tclsh""... $ac_c" 1>&6
-echo "configure:6014: checking for tclsh" >&5
+echo "configure:6026: checking for tclsh" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_tclsh'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6042,7 +6054,7 @@ fi
 
 
     echo $ac_n "checking for wish""... $ac_c" 1>&6
-echo "configure:6046: checking for wish" >&5
+echo "configure:6058: checking for wish" >&5
 
     if eval "test \"`echo '$''{'ac_cv_path_wish'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6301,6 +6313,7 @@ s%@MAKE_LIB@%$MAKE_LIB%g
 s%@MAKE_SHARED_LIB@%$MAKE_SHARED_LIB%g
 s%@MAKE_STATIC_LIB@%$MAKE_STATIC_LIB%g
 s%@MAKE_STUB_LIB@%$MAKE_STUB_LIB%g
+s%@RANLIB_STUB@%$RANLIB_STUB%g
 s%@TCLSH_PROG@%$TCLSH_PROG%g
 s%@WISH_PROG@%$WISH_PROG%g
 
--- libtiff/tiffconf.h.orig	2005-11-10 01:02:10.000000000 -0800
+++ libtiff/tiffconf.h	2005-11-10 01:53:43.000000000 -0800
@@ -61,8 +61,19 @@
 #define	HOST_FILLORDER	FILLORDER_MSB2LSB
 #endif
 #ifndef	HOST_BIGENDIAN
+#ifdef __BIG_ENDIAN__
 #define	HOST_BIGENDIAN	1
-#endif
+#else /* !__BIG_ENDIAN__ */
+#define	HOST_BIGENDIAN	1
+#endif /* __BIG_ENDIAN__ */
+#endif /* HOST_BIGENDIAN */
+
+#undef	WORDS_BIGENDIAN
+#ifdef __BIG_ENDIAN__
+#define	WORDS_BIGENDIAN
+#else /* !__BIG_ENDIAN__ */
+/* #undef HOST_BIGENDIAN */
+#endif /* __BIG_ENDIAN__ */
 
 #ifndef USE_64BIT_API
 #  define USE_64BIT_API	0
diff -u tcl.m4.orig tcl.m4
--- base/tclconfig/tcl.m4	2006-04-17 00:42:06.000000000 -0700
+++ base/tclconfig/tcl.m4	2006-04-16 00:12:51.000000000 -0700
@@ -2582,7 +2582,7 @@
 	MAKE_STUB_LIB="\${STLIB_LD} -out:\[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     else
 	MAKE_STATIC_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)_OBJECTS)"
-	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS}"
+	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS} \${TCL_SHLIB_LD_EXTRAS}"
 	MAKE_STUB_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     fi
 
diff -u tcl.m4.orig tcl.m4
--- libjpeg/tcl/tclconfig/tcl.m4	2006-04-17 00:42:06.000000000 -0700
+++ libjpeg/tcl/tclconfig/tcl.m4	2006-04-16 00:12:51.000000000 -0700
@@ -2582,7 +2582,7 @@
 	MAKE_STUB_LIB="\${STLIB_LD} -out:\[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     else
 	MAKE_STATIC_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)_OBJECTS)"
-	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS}"
+	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS} \${TCL_SHLIB_LD_EXTRAS}"
 	MAKE_STUB_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     fi
 
diff -u tcl.m4.orig tcl.m4
--- libpng/tcl/tclconfig/tcl.m4	2006-04-17 00:42:06.000000000 -0700
+++ libpng/tcl/tclconfig/tcl.m4	2006-04-16 00:12:51.000000000 -0700
@@ -2582,7 +2582,7 @@
 	MAKE_STUB_LIB="\${STLIB_LD} -out:\[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     else
 	MAKE_STATIC_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)_OBJECTS)"
-	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS}"
+	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS} \${TCL_SHLIB_LD_EXTRAS}"
 	MAKE_STUB_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     fi
 
diff -u tcl.m4.orig tcl.m4
--- libtiff/tcl/tclconfig/tcl.m4	2006-04-17 00:42:06.000000000 -0700
+++ libtiff/tcl/tclconfig/tcl.m4	2006-04-16 00:12:51.000000000 -0700
@@ -2582,7 +2582,7 @@
 	MAKE_STUB_LIB="\${STLIB_LD} -out:\[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     else
 	MAKE_STATIC_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)_OBJECTS)"
-	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS}"
+	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS} \${TCL_SHLIB_LD_EXTRAS}"
 	MAKE_STUB_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     fi
 
diff -u tcl.m4.orig tcl.m4
--- libz/tcl/tclconfig/tcl.m4	2006-04-17 00:42:06.000000000 -0700
+++ libz/tcl/tclconfig/tcl.m4	2006-04-16 00:12:51.000000000 -0700
@@ -2582,7 +2582,7 @@
 	MAKE_STUB_LIB="\${STLIB_LD} -out:\[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     else
 	MAKE_STATIC_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)_OBJECTS)"
-	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS}"
+	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS} \${TCL_SHLIB_LD_EXTRAS}"
 	MAKE_STUB_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     fi
 
diff -u tcl.m4.diff.orig tcl.m4.diff
--- config/tcl.m4.diff	2006-04-17 10:56:15.000000000 -0700
+++ configt/cl.m4.diff.new	2006-04-17 10:58:50.000000000 -0700
@@ -126,7 +126,7 @@
   		MAKE_SHARED_LIB="\${SHLIB_LD} \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS} \$(LDFLAGS) -out:\[$]@ \$(\[$]@_OBJECTS) "
 + 	    else
 + 		MAKE_STATIC_LIB="\${STLIB_LD} \[$]@ \$(\[$]@_OBJECTS)"
-+ 		MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ --output-lib \[$](patsubst %.dll,lib%.a,\[$]@) \$(\[$]@_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS}"
++ 		MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ --output-lib \[$](patsubst %.dll,lib%.a,\[$]@) \$(\[$]@_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS} \${TCL_SHLIB_LD_EXTRAS}"
   	    fi
   	    ;;
   	*)
diff -u tcl.m4.orig tcl.m4
--- tclconfig/tcl.m4	2006-04-17 00:42:06.000000000 -0700
+++ tclconfig/tcl.m4	2006-04-16 00:12:51.000000000 -0700
@@ -2582,7 +2582,7 @@
 	MAKE_STUB_LIB="\${STLIB_LD} -out:\[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     else
 	MAKE_STATIC_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)_OBJECTS)"
-	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS}"
+	MAKE_SHARED_LIB="\${SHLIB_LD} -o \[$]@ \$(\[$](PACKAGE)_OBJECTS) \${SHLIB_LDFLAGS} \${SHLIB_LD_LIBS} \${TCL_SHLIB_LD_EXTRAS}"
 	MAKE_STUB_LIB="\${STLIB_LD} \[$]@ \$(\[$](PACKAGE)stub_OBJECTS)"
     fi
 
