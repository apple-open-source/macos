check_PROGRAMS = test
test_LDADD = $(top_builddir)/src/libmagic.la
test_CPPFLAGS = -I$(top_builddir)/src

EXTRA_DIST = \
regex-eol.magic \
CVE-2014-1943.testfile \
JW07022A.mp3.testfile \
escapevel.testfile \
fat-gpu.testfile \
fit-map-data.testfile \
gedcom.testfile \
hddrawcopytool.testfile \
issue311docx.testfile \
issue359xlsx.testfile \
json1.testfile \
json2.testfile \
json3.testfile \
applegpu_gx2.testfile \
applegpu_g4p.testfile \
applegpu_g4g.testfile \
applegpu_g5p.testfile \
applegpu_g9p.testfile \
applegpu_g9g.testfile \
applegpu_g10p.testfile \
applegpu_g11p.testfile \
applegpu_g11m.testfile \
applegpu_g11g.testfile \
applegpu_g11g_8fstp.testfile \
applegpu_g12p.testfile \
applegpu_g13p.testfile \
applegpu_g13g.testfile \
applegpu_g13s.testfile \
applegpu_g13c.testfile \
applegpu_g13d.testfile \
applegpu_g14p.testfile \
applegpu_g14g.testfile \
applegpu_g14s.testfile \
applegpu_g14d.testfile \
applegpu_g15p.testfile \
applegpu_g15g.testfile \
applegpu_g15s.testfile \
applegpu_g16p.testfile \
amdgpu_gfx600.testfile \
amdgpu_gfx600_nwh.testfile \
amdgpu_gfx701.testfile \
amdgpu_gfx704.testfile \
amdgpu_gfx803.testfile \
amdgpu_gfx802.testfile \
amdgpu_gfx900.testfile \
amdgpu_gfx904.testfile \
amdgpu_gfx906.testfile \
amdgpu_gfx1010_nsgc.testfile \
amdgpu_gfx1010.testfile \
amdgpu_gfx1011.testfile \
amdgpu_gfx1012.testfile \
amdgpu_gfx1030.testfile \
amdgpu_gfx1032.testfile \
intelgpu_skl_gt2r6.testfile \
intelgpu_skl_gt2r7.testfile \
intelgpu_skl_gt3r10.testfile \
intelgpu_kbl_gt2r0.testfile \
intelgpu_kbl_gt2r2.testfile \
intelgpu_kbl_gt2r4.testfile \
intelgpu_kbl_gt3r1.testfile \
intelgpu_kbl_gt3r6.testfile \
intelgpu_icl_1x6x8r7.testfile \
intelgpu_icl_1x8x8r7.testfile \
mach-gpu-executable.testfile \
mach-gpu-dylib.testfile \
metallib.testfile \
metallib-ci-library.testfile \
metallib-dynamic-library.testfile \
metallib-companion.testfile \
metallib-macos.testfile \
metallib-stub.testfile \
universal-gpu.testfile \
regex-eol.testfile \
zstd-v0.2-FF.testfile \
zstd-v0.3-FF.testfile \
zstd-v0.4-FF.testfile \
zstd-v0.5-FF.testfile \
zstd-v0.6-FF.testfile \
zstd-v0.7-21.testfile \
zstd-v0.7-22.testfile \
zstd-v0.8-01.testfile \
zstd-v0.8-02.testfile \
zstd-v0.8-03.testfile \
zstd-v0.8-16.testfile \
zstd-v0.8-20.testfile \
zstd-v0.8-21.testfile \
zstd-v0.8-22.testfile \
zstd-v0.8-23.testfile \
zstd-v0.8-F4.testfile \
zstd-v0.8-FF.testfile \
pgp-binary-key-v2-phil.testfile \
pgp-binary-key-v3-lutz.testfile \
pgp-binary-key-v4-dsa.testfile \
pgp-binary-key-v4-ecc-no-userid-secret.testfile \
pgp-binary-key-v4-ecc-secret-key.testfile \
pgp-binary-key-v4-rsa-key.testfile \
pgp-binary-key-v4-rsa-no-userid-secret.testfile \
pgp-binary-key-v4-rsa-secret-key.testfile \
CVE-2014-1943.result \
JW07022A.mp3.result \
escapevel.result \
fat-gpu.result \
fit-map-data.result \
gedcom.result \
hddrawcopytool.result \
issue311docx.result \
issue359xlsx.result \
json1.result \
json2.result \
json3.result \
applegpu_gx2.result \
applegpu_g4p.result \
applegpu_g4g.result \
applegpu_g5p.result \
applegpu_g9p.result \
applegpu_g9g.result \
applegpu_g10p.result \
applegpu_g11p.result \
applegpu_g11m.result \
applegpu_g11g.result \
applegpu_g11g_8fstp.result \
applegpu_g12p.result \
applegpu_g13p.result \
applegpu_g13g.result \
applegpu_g13s.result \
applegpu_g13c.result \
applegpu_g13d.result \
applegpu_g14p.result \
applegpu_g14g.result \
applegpu_g14s.result \
applegpu_g14d.result \
applegpu_g15p.result \
applegpu_g15g.result \
applegpu_g15s.result \
applegpu_g16p.result \
amdgpu_gfx600.result \
amdgpu_gfx600_nwh.result \
amdgpu_gfx701.result \
amdgpu_gfx704.result \
amdgpu_gfx803.result \
amdgpu_gfx802.result \
amdgpu_gfx900.result \
amdgpu_gfx904.result \
amdgpu_gfx906.result \
amdgpu_gfx1010_nsgc.result \
amdgpu_gfx1010.result \
amdgpu_gfx1011.result \
amdgpu_gfx1012.result \
amdgpu_gfx1030.result \
amdgpu_gfx1032.result \
intelgpu_skl_gt2r6.result \
intelgpu_skl_gt2r7.result \
intelgpu_skl_gt3r10.result \
intelgpu_kbl_gt2r0.result \
intelgpu_kbl_gt2r2.result \
intelgpu_kbl_gt2r4.result \
intelgpu_kbl_gt3r1.result \
intelgpu_kbl_gt3r6.result \
intelgpu_icl_1x6x8r7.result \
intelgpu_icl_1x8x8r7.result \
mach-gpu-dylib.result \
mach-gpu-executable.result \
metallib.result \
metallib-ci-library.result \
metallib-dynamic-library.result \
metallib-companion.result \
metallib-macos.result \
metallib-stub.result \
universal-gpu.result \
regex-eol.result \
zstd-3-skippable-frames.result \
zstd-dictionary-0.result \
zstd-dictionary-1.result \
zstd-dictionary-2.result \
zstd-skippable-frame-0.result \
zstd-skippable-frame-4.result \
zstd-skippable-frame-8.result \
zstd-skippable-frame-C.result \
zstd-v0.2-FF.result \
zstd-v0.2-FF.testfile \
zstd-v0.3-FF.result \
zstd-v0.3-FF.testfile \
zstd-v0.4-FF.result \
zstd-v0.4-FF.testfile \
zstd-v0.5-FF.result \
zstd-v0.5-FF.testfile \
zstd-v0.6-FF.result \
zstd-v0.6-FF.testfile \
zstd-v0.7-00.result \
zstd-v0.7-21.result \
zstd-v0.7-21.testfile \
zstd-v0.7-22.result \
zstd-v0.7-22.testfile \
zstd-v0.8-00.result \
zstd-v0.8-01.result \
zstd-v0.8-01.testfile \
zstd-v0.8-02.result \
zstd-v0.8-02.testfile \
zstd-v0.8-03.result \
zstd-v0.8-03.testfile \
zstd-v0.8-16.result \
zstd-v0.8-16.testfile \
zstd-v0.8-20.result \
zstd-v0.8-20.testfile \
zstd-v0.8-21.result \
zstd-v0.8-21.testfile \
zstd-v0.8-22.result \
zstd-v0.8-22.testfile \
zstd-v0.8-23.result \
zstd-v0.8-23.testfile \
zstd-v0.8-F4.result \
zstd-v0.8-F4.testfile \
zstd-v0.8-FF.result \
zstd-v0.8-FF.testfile

T = $(top_srcdir)/tests
check-local:
	MAGIC=$(top_builddir)/magic/magic ./test
	set -e; \
	for i in $T/*.testfile; do \
		echo Running test: $$i; \
		if [ -f $${i%%.testfile}.magic ]; then \
			m=$${i%%.testfile}.magic; \
		else \
			m=$(top_builddir)/magic/magic; \
		fi; \
		TZ=UTC MAGIC=$$m ./test $$i $${i%%.testfile}.result; \
	done
